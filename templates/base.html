{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />
  <title>{% block title %}Wrong-Answer Packets{% endblock %}</title>

  <!-- Fonts + Tailwind (no build step) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand:'#2563eb', brandDark:'#1d4ed8', ink:'#0f172a' },
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] }
        }
      }
    }
  </script>

  <!-- Preload your moon image so the background appears immediately -->
  <link rel="preload" as="image" href="{% static 'img/lroc_color_poles_4k.jpg' %}">

  <style>
    :root{
      --brand:#2563eb; --brand-dark:#1d4ed8; --bg:#0b1020;
    }
    html,body { height:100%; }
    body { font-family: Inter, ui-sans-serif, system-ui; background: var(--bg); }

    /* ===== Always-on background image (works even if WebGL is off) ===== */
    body::before{
      content:"";
      position:fixed; inset:0; z-index:0; pointer-events:none;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(37,99,235,.18), transparent 60%),
        url("{% static 'img/lroc_color_poles_4k.jpg' %}") center/cover no-repeat fixed;
      filter: saturate(0.95) brightness(0.9);
      transform: translateZ(0);  /* helps some GPUs */
    }

    /* ===== 3D background layer (optional), sits above CSS bg but below content ===== */
    #moon-wrap{
      position: fixed; inset: 0;
      z-index: 1;
      pointer-events: none;
      overflow: hidden;
    }
    #bg3d{ width:100%; height:100%; display:block; }

    /* Readability veil on top of backgrounds */
    #veil{
      position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(70% 60% at 80% 10%, rgba(37,99,235,.12), transparent 55%),
        linear-gradient(to bottom, rgba(2,6,23,.35), rgba(2,6,23,.65));
      z-index:2;
    }

    /* If WebGL is disabled or motion is reduced, just keep the CSS background */
    .no-webgl #bg3d, .reduced-motion #bg3d { display:none; }

    /* UI buttons */
    .btn { display:inline-flex; align-items:center; justify-content:center;
           gap:.5rem; padding:.6rem 1rem; border-radius:.75rem; font-weight:600;
           transition:all .15s ease; border:1px solid transparent; }
    .btn-primary { background:var(--brand); color:#fff; }
    .btn-primary:hover { background:var(--brand-dark); }
    .btn-outline { background:#ffffffcc; border-color:#e5e7eb; color:#0f172a; backdrop-filter: blur(6px); }
    .btn-outline:hover { border-color:var(--brand); color:var(--brand); }

    /* Keep app content above backgrounds */
    header, main, footer { position: relative; z-index: 10; }

    /* ===== ONLY CHANGE: make form fields readable (dark text on white) ===== */
    input, textarea, select {
      color: #0f172a !important;       /* dark ink */
      background: #ffffff !important;  /* white background */
      caret-color: #0f172a;
      border: 1px solid #e5e7eb;
      border-radius: .75rem;
      padding: .65rem .8rem;
    }
    input::placeholder, textarea::placeholder {
      color: #64748b; /* slate-500 */
      opacity: 1;
    }
    /* Chrome/Safari autofill fix: keep dark text and white bg */
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    textarea:-webkit-autofill,
    select:-webkit-autofill {
      -webkit-text-fill-color: #0f172a !important;
      box-shadow: 0 0 0px 1000px #ffffff inset;
      transition: background-color 9999s ease-out 0s;
    }
  </style>

  <!-- MathJax (used on practice/teacher pages) -->
  <script>
    window.MathJax = { tex:{inlineMath:[['$','$'],['\\(','\\)']]}, svg:{fontCache:'global'} };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  {% block head %}{% endblock %}
</head>
<body>
  <!-- Optional 3D background -->
  <div id="moon-wrap" aria-hidden="true">
    <canvas id="bg3d"></canvas>
    <div id="veil"></div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/70 border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      {% if user.is_authenticated %}
        <a href="/dashboard/" class="font-semibold text-xl text-ink">Wrong-Answer Packets</a>
      {% else %}
        <a href="/" class="font-semibold text-xl text-ink">Wrong-Answer Packets</a>
      {% endif %}

      <nav class="ml-auto flex items-center gap-3 text-sm">
        {% if user.is_authenticated %}
          <a class="btn btn-outline" href="/dashboard/">Dashboard</a>
          <a class="btn btn-outline" href="/practice/">Practice</a>
          <a class="btn btn-outline" href="/teacher/">Teacher</a>
          <form method="post" action="{% url 'logout' %}" class="inline">{% csrf_token %}
            <button class="btn btn-primary">Log out</button>
          </form>
        {% else %}
          <a class="btn btn-outline" href="/practice/">Try Practice</a>
          <a class="btn btn-primary" href="{% url 'login' %}">Sign in</a>
          <a class="btn btn-outline" href="{% url 'register' %}">Sign up</a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-10">
    {% block content %}{% endblock %}
  </main>

  <footer class="text-center text-sm text-slate-300 py-10">
    Â© {{ now|date:"Y" }} Wrong-Answer Packets
  </footer>

  {% block scripts %}{% endblock %}

  <!-- three.js (optional) -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script>
    (function () {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) document.body.classList.add('reduced-motion');

      const hasWebGL = !!(window.WebGLRenderingContext);
      if (!hasWebGL || prefersReduced) { document.body.classList.add('no-webgl'); return; }

      const canvas = document.getElementById('bg3d');
      const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.8));
      renderer.outputColorSpace = THREE.SRGBColorSpace;

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, 2, 0.1, 1000);
      camera.position.set(0, 0, 130);

      // Lights
      const key = new THREE.DirectionalLight(0xffffff, 1.05);
      key.position.set(2, 1.2, 2.2);
      scene.add(key);
      scene.add(new THREE.AmbientLight(0x606060));

      // Moon
      const R = 50;
      const geo = new THREE.SphereGeometry(R, 64, 64);
      const tex = new THREE.TextureLoader().load("{% static 'img/lroc_color_poles_4k.jpg' %}");
      tex.colorSpace = THREE.SRGBColorSpace;
      tex.anisotropy = 8;

      const mat = new THREE.MeshPhongMaterial({
        map: tex,
        bumpMap: tex,
        bumpScale: 0.35,
        shininess: 6
      });
      const moon = new THREE.Mesh(geo, mat);
      scene.add(moon);

      // Optional red pin demo
      const pin = new THREE.Group();
      const pinStem = new THREE.Mesh(
        new THREE.CylinderGeometry(0.3, 0.3, 6, 12),
        new THREE.MeshBasicMaterial({ color: 0xff2d55 })
      );
      pinStem.position.y = 3;
      const pinHead = new THREE.Mesh(
        new THREE.SphereGeometry(1.2, 16, 16),
        new THREE.MeshBasicMaterial({ color: 0xff2d55 })
      );
      pin.add(pinStem); pin.add(pinHead);
      scene.add(pin);

      function latLonToVec3(latDeg, lonDeg, radius) {
        const lat = THREE.MathUtils.degToRad(latDeg);
        const lon = THREE.MathUtils.degToRad(lonDeg);
        const x = radius * Math.cos(lat) * Math.cos(lon);
        const y = radius * Math.sin(lat);
        const z = radius * Math.cos(lat) * Math.sin(lon);
        return new THREE.Vector3(x, y, z);
      }
      pin.position.copy(latLonToVec3(20, -45, R * 1.05));
      pin.lookAt(new THREE.Vector3(0,0,0));
      pin.rotateX(Math.PI/2);

      function resize() {
        const w = canvas.clientWidth, h = canvas.clientHeight;
        renderer.setSize(w, h, false);
        camera.aspect = w / h; camera.updateProjectionMatrix();
      }
      window.addEventListener('resize', resize);
      resize();

      function tick() {
        moon.rotation.y += 0.0016;
        pin.rotateOnWorldAxis(new THREE.Vector3(0,1,0), 0.0016);
        renderer.render(scene, camera);
        requestAnimationFrame(tick);
      }
      tick();
    })();
  </script>
</body>
</html>








